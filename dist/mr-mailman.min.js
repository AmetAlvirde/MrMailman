"use strict";function deliverMails(a,b,c,d,e){var f,g={},h=nodemailer.createTransport(e);return R.forEach(function(b){g.from=a,g.to=b,g.subject=c,g.markdown=d,h.use("compile",nodemailerMarkdown()),h.sendMail(g,function(a,b){console.log("IM IN"),a&&(console.log("####ERROR####3"),console.log(a),console.log("########3"),f=a),f="Message sent: "+b.response,console.log("####RESULT####3"),console.log(f),console.log("########3")})},b),console.log("########3"),console.log(f),console.log("########3"),f}function spyAndReplace(a,b){var c=new ReadWriteLock,d=Q.defer();return c.writeLock(function(c){Q.nfcall(fs.readFile,b,"utf-8").then(function(b){var e,f;R.forEach(function(a){e=R.keys(a)[0],f=new RegExp(e,"g"),b=b.replace(f,a[e])},a),c(),d.resolve(b)})["catch"](function(a){console.log(a)})}),d.promise}var fs=require("fs"),Q=require("q"),nodemailerMarkdown=require("nodemailer-markdown").markdown,nodemailer=require("nodemailer"),R=require("ramda"),ReadWriteLock=require("rwlock");module.exports={deliver:function(a){var b={service:a.auth.service,auth:{user:a.auth.user,pass:a.auth.password}};spyAndReplace(a.content.replaces,a.content.templateURL).then(function(c){deliverMails(a.content.from,a.content.receivers,a.content.subject,c,b)})},spyAndReplace:spyAndReplace,deliverMails:deliverMails};