"use strict";function deliverMails(a,b,c,d,e){var f={},g=nodemailer.createTransport(e);R.forEach(function(b){f.from=a,f.to=b,f.subject=c,f.markdown=d,g.use("compile",nodemailerMarkdown()),g.sendMail(f,function(a,b){console.log("sending mail"),a?console.log(a):console.log("Message sent: "+b.response)})},b)}function spyAndReplace(a,b){var c=new ReadWriteLock,d=Q.defer();return c.writeLock(function(c){Q.nfcall(fs.readFile,b,"utf-8").then(function(b){var e,f;R.forEach(function(a){e=R.keys(a)[0],f=new RegExp(e,"g"),b=b.replace(f,a[e])},a),c(),d.resolve(b)})["catch"](function(a){console.log(a)})}),d.promise}var fs=require("fs"),Q=require("q"),nodemailerMarkdown=require("nodemailer-markdown").markdown,nodemailer=require("nodemailer"),R=require("ramda"),ReadWriteLock=require("rwlock");module.exports={deliver:function(a){var b={service:a.auth.service,auth:{user:a.auth.user,pass:a.auth.password}};spyAndReplace(a.content.replaces,a.content.templateURL).then(function(c){deliverMails(a.content.from,a.content.receivers,a.content.subject,c,b)})}};